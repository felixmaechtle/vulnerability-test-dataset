import os
import shutil
from tqdm import tqdm

# delete leftover directories
os.system('find . -type d -name "GeneratedClass_optimized.class" -exec rm -rf {} \;')

for dir in tqdm(os.listdir('./tmp'), smoothing=0):
    slice_dir = f'./tmp/{dir}/slicing/'
    if not os.path.exists(slice_dir) or not os.listdir(slice_dir): # not existent or empty
        # delete as there are no slices
        shutil.rmtree(f'./tmp/{dir}/')
        continue

    # slices exist, delete everything but the slice
    d = f'./tmp/{dir}/'
    if os.path.isfile(f'{d}GeneratedClass.java'): # allow for multiple executions
        os.remove(f'{d}GeneratedClass.java')
        os.remove(f'{d}GeneratedClass.class')

    # delete all possibly non compilable traces
    for slice_id in os.listdir(slice_dir):
        for file in os.listdir(f'{slice_dir}{slice_id}/'):
            if file == 'compilable':
                continue

            os.remove(f'{slice_dir}{slice_id}/{file}')

    # build all java projects
    for slice_id in os.listdir(slice_dir):
        os.system(f'cd {slice_dir}{slice_id}/compilable && javac *.java')
